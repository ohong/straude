{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/components/app/feed/ActivityCard.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { Zap, MessageCircle, Share2, CheckCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils/cn\";\nimport type { Post } from \"@/types\";\nimport ReactMarkdown from \"react-markdown\";\nimport { useState } from \"react\";\n\nfunction timeAgo(dateStr: string) {\n  const diff = Date.now() - new Date(dateStr).getTime();\n  const mins = Math.floor(diff / 60000);\n  if (mins < 1) return \"just now\";\n  if (mins < 60) return `${mins}m ago`;\n  const hrs = Math.floor(mins / 60);\n  if (hrs < 24) return `${hrs}h ago`;\n  const days = Math.floor(hrs / 24);\n  if (days < 7) return `${days}d ago`;\n  return new Date(dateStr).toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" });\n}\n\nfunction formatTokens(n: number) {\n  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;\n  if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;\n  return String(n);\n}\n\nfunction formatModel(models: string[]) {\n  if (!models || models.length === 0) return null;\n  const m = models[0];\n  if (m.includes(\"opus\")) return \"Claude Opus\";\n  if (m.includes(\"sonnet\")) return \"Claude Sonnet\";\n  if (m.includes(\"haiku\")) return \"Claude Haiku\";\n  return m;\n}\n\nexport function ActivityCard({ post }: { post: Post }) {\n  const [kudosed, setKudosed] = useState(post.has_kudosed ?? false);\n  const [kudosCount, setKudosCount] = useState(post.kudos_count ?? 0);\n  const [animating, setAnimating] = useState(false);\n\n  const user = post.user;\n  const usage = post.daily_usage;\n\n  async function toggleKudos() {\n    const method = kudosed ? \"DELETE\" : \"POST\";\n    setKudosed(!kudosed);\n    setKudosCount((c) => (kudosed ? c - 1 : c + 1));\n    if (!kudosed) {\n      setAnimating(true);\n      setTimeout(() => setAnimating(false), 200);\n    }\n    await fetch(`/api/posts/${post.id}/kudos`, { method });\n  }\n\n  async function handleShare() {\n    const url = `${window.location.origin}/post/${post.id}`;\n    await navigator.clipboard.writeText(url);\n  }\n\n  return (\n    <article className=\"border-b border-border p-6\">\n      {/* Header */}\n      <div className=\"flex items-center gap-3\">\n        <Link href={user?.username ? `/u/${user.username}` : \"#\"}>\n          {user?.avatar_url ? (\n            <img src={user.avatar_url} alt=\"\" className=\"h-10 w-10 rounded-full object-cover\" />\n          ) : (\n            <span className=\"flex h-10 w-10 items-center justify-center rounded-full bg-foreground text-sm font-semibold text-background\">\n              {user?.username?.[0]?.toUpperCase() ?? \"?\"}\n            </span>\n          )}\n        </Link>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <Link\n              href={user?.username ? `/u/${user.username}` : \"#\"}\n              className=\"font-semibold hover:underline\"\n            >\n              {user?.username ?? \"anonymous\"}\n            </Link>\n          </div>\n          <div className=\"flex items-center gap-2 text-xs text-muted\">\n            <span>{timeAgo(post.created_at)}</span>\n            {usage?.models && usage.models.length > 0 && (\n              <>\n                <span>&middot;</span>\n                <span>{formatModel(usage.models)}</span>\n              </>\n            )}\n            {usage?.is_verified && (\n              <span className=\"inline-flex items-center gap-1 font-semibold text-accent\">\n                <CheckCircle size={12} />\n                Verified\n              </span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Body */}\n      <div className=\"mt-4\">\n        {post.title && (\n          <Link href={`/post/${post.id}`}>\n            <h2 className=\"text-xl font-medium hover:underline\" style={{ letterSpacing: \"-0.02em\" }}>\n              {post.title}\n            </h2>\n          </Link>\n        )}\n        {post.description && (\n          <div className=\"mt-2 text-[0.95rem] leading-relaxed [&_a]:text-accent [&_a]:underline [&_code]:bg-subtle [&_code]:px-1 [&_code]:py-0.5 [&_code]:font-[family-name:var(--font-mono)] [&_code]:text-sm [&_pre]:mt-2 [&_pre]:overflow-x-auto [&_pre]:border-l-2 [&_pre]:border-l-accent [&_pre]:bg-subtle [&_pre]:p-3 [&_pre]:font-[family-name:var(--font-mono)] [&_pre]:text-sm\">\n            <ReactMarkdown\n              allowedElements={[\"p\", \"strong\", \"em\", \"code\", \"pre\", \"a\", \"br\"]}\n              unwrapDisallowed\n            >\n              {post.description}\n            </ReactMarkdown>\n          </div>\n        )}\n\n        {/* Images */}\n        {post.images && post.images.length > 0 && (\n          <div\n            className={cn(\n              \"mt-3 grid gap-2\",\n              post.images.length === 1 && \"grid-cols-1\",\n              post.images.length === 2 && \"grid-cols-2\",\n              post.images.length >= 3 && \"grid-cols-2\"\n            )}\n          >\n            {post.images.map((url, i) => (\n              <img\n                key={i}\n                src={url}\n                alt=\"\"\n                className={cn(\n                  \"w-full object-cover\",\n                  post.images.length === 3 && i === 0 && \"row-span-2\"\n                )}\n                style={{ maxHeight: 300 }}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Stats grid */}\n        {usage && (\n          <div className=\"mt-4 grid grid-cols-3 gap-4\">\n            <div>\n              <p className=\"text-[0.7rem] uppercase tracking-widest text-muted\">Cost</p>\n              <p className=\"font-[family-name:var(--font-mono)] text-[1.1rem] font-medium tabular-nums text-accent\">\n                ${Number(usage.cost_usd).toFixed(2)}\n              </p>\n            </div>\n            <div>\n              <p className=\"text-[0.7rem] uppercase tracking-widest text-muted\">Tokens</p>\n              <p className=\"font-[family-name:var(--font-mono)] text-[1.1rem] font-medium tabular-nums\">\n                {formatTokens(Number(usage.total_tokens))}\n              </p>\n            </div>\n            <div>\n              <p className=\"text-[0.7rem] uppercase tracking-widest text-muted\">Sessions</p>\n              <p className=\"font-[family-name:var(--font-mono)] text-[1.1rem] font-medium tabular-nums\">\n                {usage.session_count}\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Actions */}\n      <div className=\"mt-4 flex gap-6 border-t border-dashed border-muted/30 pt-4\">\n        <button\n          onClick={toggleKudos}\n          className={cn(\n            \"flex items-center gap-2 text-sm font-semibold hover:text-accent\",\n            kudosed && \"text-accent\"\n          )}\n        >\n          <span\n            className={cn(\"inline-block transition-transform\", animating && \"scale-120\")}\n            style={{ transitionDuration: \"200ms\" }}\n          >\n            <Zap size={16} fill={kudosed ? \"currentColor\" : \"none\"} />\n          </span>\n          Kudos ({kudosCount})\n        </button>\n        <Link\n          href={`/post/${post.id}`}\n          className=\"flex items-center gap-2 text-sm font-semibold hover:text-accent\"\n        >\n          <MessageCircle size={16} />\n          Comment ({post.comment_count ?? 0})\n        </Link>\n        <button\n          onClick={handleShare}\n          className=\"ml-auto flex items-center gap-2 text-sm font-semibold hover:text-accent\"\n        >\n          Share <Share2 size={16} />\n        </button>\n      </div>\n    </article>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 490, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/components/app/feed/FeedList.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState, useCallback } from \"react\";\nimport { ActivityCard } from \"./ActivityCard\";\nimport type { Post } from \"@/types\";\n\nexport function FeedList({\n  initialPosts,\n  userId,\n}: {\n  initialPosts: Post[];\n  userId: string;\n}) {\n  const [posts, setPosts] = useState<Post[]>(initialPosts);\n  const [cursor, setCursor] = useState<string | null>(\n    initialPosts.length >= 20\n      ? initialPosts[initialPosts.length - 1].created_at\n      : null\n  );\n  const [loading, setLoading] = useState(false);\n  const sentinel = useRef<HTMLDivElement>(null);\n\n  const loadMore = useCallback(async () => {\n    if (!cursor || loading) return;\n    setLoading(true);\n\n    const res = await fetch(`/api/feed?cursor=${encodeURIComponent(cursor)}&limit=20`);\n    const data = await res.json();\n\n    if (data.posts?.length) {\n      setPosts((prev) => [...prev, ...data.posts]);\n      setCursor(data.next_cursor ?? null);\n    } else {\n      setCursor(null);\n    }\n    setLoading(false);\n  }, [cursor, loading]);\n\n  useEffect(() => {\n    if (!sentinel.current) return;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) loadMore();\n      },\n      { rootMargin: \"200px\" }\n    );\n    observer.observe(sentinel.current);\n    return () => observer.disconnect();\n  }, [loadMore]);\n\n  return (\n    <div>\n      {posts.map((post) => (\n        <ActivityCard key={post.id} post={post} />\n      ))}\n      {cursor && (\n        <div ref={sentinel} className=\"flex justify-center py-8\">\n          {loading && <span className=\"text-sm text-muted\">Loading...</span>}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAMO,SAAS,SAAS,EACvB,YAAY,EACZ,MAAM,EAIP;IACC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,sRAAQ,EAAS;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,sRAAQ,EAClC,aAAa,MAAM,IAAI,KACnB,YAAY,CAAC,aAAa,MAAM,GAAG,EAAE,CAAC,UAAU,GAChD;IAEN,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,sRAAQ,EAAC;IACvC,MAAM,WAAW,IAAA,oRAAM,EAAiB;IAExC,MAAM,WAAW,IAAA,yRAAW,EAAC;QAC3B,IAAI,CAAC,UAAU,SAAS;QACxB,WAAW;QAEX,MAAM,MAAM,MAAM,MAAM,CAAC,iBAAiB,EAAE,mBAAmB,QAAQ,SAAS,CAAC;QACjF,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,KAAK,KAAK,EAAE,QAAQ;YACtB,SAAS,CAAC,OAAS;uBAAI;uBAAS,KAAK,KAAK;iBAAC;YAC3C,UAAU,KAAK,WAAW,IAAI;QAChC,OAAO;YACL,UAAU;QACZ;QACA,WAAW;IACb,GAAG;QAAC;QAAQ;KAAQ;IAEpB,IAAA,uRAAS,EAAC;QACR,IAAI,CAAC,SAAS,OAAO,EAAE;QACvB,MAAM,WAAW,IAAI,qBACnB,CAAC;YACC,IAAI,OAAO,CAAC,EAAE,CAAC,cAAc,EAAE;QACjC,GACA;YAAE,YAAY;QAAQ;QAExB,SAAS,OAAO,CAAC,SAAS,OAAO;QACjC,OAAO,IAAM,SAAS,UAAU;IAClC,GAAG;QAAC;KAAS;IAEb,qBACE,mTAAC;;YACE,MAAM,GAAG,CAAC,CAAC,qBACV,mTAAC,yKAAY;oBAAe,MAAM;mBAAf,KAAK,EAAE;;;;;YAE3B,wBACC,mTAAC;gBAAI,KAAK;gBAAU,WAAU;0BAC3B,yBAAW,mTAAC;oBAAK,WAAU;8BAAqB;;;;;;;;;;;;;;;;;AAK3D"}}]
}