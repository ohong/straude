{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet: { name: string; value: string; options?: Record<string, unknown> }[]) {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore.set(name, value, options as any)\n          );\n        },\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,iNAAO;IACjC,OAAO,IAAA,kRAAkB,oKAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAkF;gBACvF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;YAEjC;QACF;IACF;AAEJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/app/api/feed/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport async function GET(request: NextRequest) {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  const { searchParams } = request.nextUrl;\n  const cursor = searchParams.get(\"cursor\");\n  const limit = Math.min(Number(searchParams.get(\"limit\") ?? 20), 50);\n\n  // Get IDs of users the current user follows\n  const { data: followData } = await supabase\n    .from(\"follows\")\n    .select(\"following_id\")\n    .eq(\"follower_id\", user.id);\n\n  const followingIds = (followData ?? []).map((f) => f.following_id);\n\n  if (followingIds.length === 0) {\n    return NextResponse.json({ posts: [], next_cursor: undefined });\n  }\n\n  // Get posts from followed users\n  let query = supabase\n    .from(\"posts\")\n    .select(\n      `\n      *,\n      user:users!posts_user_id_fkey(*),\n      daily_usage:daily_usage!posts_daily_usage_id_fkey(*),\n      kudos_count:kudos(count),\n      comment_count:comments(count)\n    `\n    )\n    .in(\"user_id\", followingIds)\n    .order(\"created_at\", { ascending: false })\n    .limit(limit);\n\n  if (cursor) {\n    query = query.lt(\"created_at\", cursor);\n  }\n\n  const { data: posts, error } = await query;\n\n  if (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n\n  // Check which posts the current user has kudosed\n  const postIds = (posts ?? []).map((p) => p.id);\n  const { data: userKudos } = postIds.length\n    ? await supabase\n        .from(\"kudos\")\n        .select(\"post_id\")\n        .eq(\"user_id\", user.id)\n        .in(\"post_id\", postIds)\n    : { data: [] };\n\n  const kudosedSet = new Set((userKudos ?? []).map((k) => k.post_id));\n\n  const enriched = (posts ?? []).map((p) => ({\n    ...p,\n    kudos_count: p.kudos_count?.[0]?.count ?? 0,\n    comment_count: p.comment_count?.[0]?.count ?? 0,\n    has_kudosed: kudosedSet.has(p.id),\n  }));\n\n  const next_cursor =\n    enriched.length === limit\n      ? enriched[enriched.length - 1]?.created_at\n      : undefined;\n\n  return NextResponse.json({ posts: enriched, next_cursor });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,WAAW,MAAM,IAAA,0JAAY;IACnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,QAAQ,OAAO;IACxC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,QAAQ,KAAK,GAAG,CAAC,OAAO,aAAa,GAAG,CAAC,YAAY,KAAK;IAEhE,4CAA4C;IAC5C,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,WACL,MAAM,CAAC,gBACP,EAAE,CAAC,eAAe,KAAK,EAAE;IAE5B,MAAM,eAAe,CAAC,cAAc,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,YAAY;IAEjE,IAAI,aAAa,MAAM,KAAK,GAAG;QAC7B,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE;YAAE,aAAa;QAAU;IAC/D;IAEA,gCAAgC;IAChC,IAAI,QAAQ,SACT,IAAI,CAAC,SACL,MAAM,CACL,CAAC;;;;;;IAMH,CAAC,EAEA,EAAE,CAAC,WAAW,cACd,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC;IAET,IAAI,QAAQ;QACV,QAAQ,MAAM,EAAE,CAAC,cAAc;IACjC;IAEA,MAAM,EAAE,MAAM,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM;IAErC,IAAI,OAAO;QACT,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,iDAAiD;IACjD,MAAM,UAAU,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;IAC7C,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,QAAQ,MAAM,GACtC,MAAM,SACH,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,WAAW,WACjB;QAAE,MAAM,EAAE;IAAC;IAEf,MAAM,aAAa,IAAI,IAAI,CAAC,aAAa,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,OAAO;IAEjE,MAAM,WAAW,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;YACzC,GAAG,CAAC;YACJ,aAAa,EAAE,WAAW,EAAE,CAAC,EAAE,EAAE,SAAS;YAC1C,eAAe,EAAE,aAAa,EAAE,CAAC,EAAE,EAAE,SAAS;YAC9C,aAAa,WAAW,GAAG,CAAC,EAAE,EAAE;QAClC,CAAC;IAED,MAAM,cACJ,SAAS,MAAM,KAAK,QAChB,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,EAAE,aAC/B;IAEN,OAAO,qNAAY,CAAC,IAAI,CAAC;QAAE,OAAO;QAAU;IAAY;AAC1D"}}]
}