{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet: { name: string; value: string; options?: Record<string, unknown> }[]) {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore.set(name, value, options as any)\n          );\n        },\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,iNAAO;IACjC,OAAO,IAAA,kRAAkB,oKAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAkF;gBACvF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;YAEjC;QACF;IACF;AAEJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/ohong/dev/straude/apps/web/app/api/leaderboard/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nconst VALID_PERIODS = [\"day\", \"week\", \"month\", \"all_time\"] as const;\ntype Period = (typeof VALID_PERIODS)[number];\n\nconst VIEW_MAP: Record<Period, string> = {\n  day: \"leaderboard_daily\",\n  week: \"leaderboard_weekly\",\n  month: \"leaderboard_monthly\",\n  all_time: \"leaderboard_all_time\",\n};\n\nexport async function GET(request: NextRequest) {\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  const { searchParams } = request.nextUrl;\n  const period = (searchParams.get(\"period\") ?? \"week\") as Period;\n  const region = searchParams.get(\"region\");\n  const cursor = searchParams.get(\"cursor\");\n  const limit = Math.min(Number(searchParams.get(\"limit\") ?? 50), 100);\n\n  if (!VALID_PERIODS.includes(period)) {\n    return NextResponse.json({ error: \"Invalid period\" }, { status: 400 });\n  }\n\n  const view = VIEW_MAP[period];\n\n  let query = supabase\n    .from(view)\n    .select(\"*\")\n    .order(\"total_cost\", { ascending: false })\n    .limit(limit);\n\n  if (region) {\n    query = query.eq(\"region\", region);\n  }\n\n  if (cursor) {\n    query = query.lt(\"total_cost\", cursor);\n  }\n\n  const { data: entries, error } = await query;\n\n  if (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n\n  // Assign ranks\n  const ranked = (entries ?? []).map((entry, i) => ({\n    ...entry,\n    rank: i + 1,\n  }));\n\n  // Find current user's rank\n  let user_rank: number | undefined;\n  if (user) {\n    const found = ranked.find((e) => e.user_id === user.id);\n    if (found) {\n      user_rank = found.rank;\n    } else {\n      // User not in this page â€” query their rank separately\n      let rankQuery = supabase\n        .from(view)\n        .select(\"*\", { count: \"exact\", head: true })\n        .gt(\"total_cost\", 0);\n\n      if (region) {\n        rankQuery = rankQuery.eq(\"region\", region);\n      }\n\n      // Get user's cost from the view\n      const { data: userEntry } = await supabase\n        .from(view)\n        .select(\"total_cost\")\n        .eq(\"user_id\", user.id)\n        .maybeSingle();\n\n      if (userEntry) {\n        const { count } = await supabase\n          .from(view)\n          .select(\"*\", { count: \"exact\", head: true })\n          .gt(\"total_cost\", userEntry.total_cost);\n\n        user_rank = (count ?? 0) + 1;\n      }\n    }\n  }\n\n  const next_cursor =\n    ranked.length === limit\n      ? ranked[ranked.length - 1]?.total_cost?.toString()\n      : undefined;\n\n  return NextResponse.json({ entries: ranked, user_rank, next_cursor });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,gBAAgB;IAAC;IAAO;IAAQ;IAAS;CAAW;AAG1D,MAAM,WAAmC;IACvC,KAAK;IACL,MAAM;IACN,OAAO;IACP,UAAU;AACZ;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,WAAW,MAAM,IAAA,0JAAY;IACnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,EAAE,YAAY,EAAE,GAAG,QAAQ,OAAO;IACxC,MAAM,SAAU,aAAa,GAAG,CAAC,aAAa;IAC9C,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,QAAQ,KAAK,GAAG,CAAC,OAAO,aAAa,GAAG,CAAC,YAAY,KAAK;IAEhE,IAAI,CAAC,cAAc,QAAQ,CAAC,SAAS;QACnC,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,OAAO,QAAQ,CAAC,OAAO;IAE7B,IAAI,QAAQ,SACT,IAAI,CAAC,MACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC;IAET,IAAI,QAAQ;QACV,QAAQ,MAAM,EAAE,CAAC,UAAU;IAC7B;IAEA,IAAI,QAAQ;QACV,QAAQ,MAAM,EAAE,CAAC,cAAc;IACjC;IAEA,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM;IAEvC,IAAI,OAAO;QACT,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,eAAe;IACf,MAAM,SAAS,CAAC,WAAW,EAAE,EAAE,GAAG,CAAC,CAAC,OAAO,IAAM,CAAC;YAChD,GAAG,KAAK;YACR,MAAM,IAAI;QACZ,CAAC;IAED,2BAA2B;IAC3B,IAAI;IACJ,IAAI,MAAM;QACR,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,KAAK,EAAE;QACtD,IAAI,OAAO;YACT,YAAY,MAAM,IAAI;QACxB,OAAO;YACL,sDAAsD;YACtD,IAAI,YAAY,SACb,IAAI,CAAC,MACL,MAAM,CAAC,KAAK;gBAAE,OAAO;gBAAS,MAAM;YAAK,GACzC,EAAE,CAAC,cAAc;YAEpB,IAAI,QAAQ;gBACV,YAAY,UAAU,EAAE,CAAC,UAAU;YACrC;YAEA,gCAAgC;YAChC,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,SAC/B,IAAI,CAAC,MACL,MAAM,CAAC,cACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,WAAW;YAEd,IAAI,WAAW;gBACb,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,MACL,MAAM,CAAC,KAAK;oBAAE,OAAO;oBAAS,MAAM;gBAAK,GACzC,EAAE,CAAC,cAAc,UAAU,UAAU;gBAExC,YAAY,CAAC,SAAS,CAAC,IAAI;YAC7B;QACF;IACF;IAEA,MAAM,cACJ,OAAO,MAAM,KAAK,QACd,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,EAAE,YAAY,aACvC;IAEN,OAAO,qNAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAQ;QAAW;IAAY;AACrE"}}]
}