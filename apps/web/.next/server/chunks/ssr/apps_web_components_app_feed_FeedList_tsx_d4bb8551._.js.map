{"version":3,"sources":["../../../../../../apps/web/components/app/feed/FeedList.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState, useCallback } from \"react\";\nimport { ActivityCard } from \"./ActivityCard\";\nimport type { Post } from \"@/types\";\n\nexport function FeedList({\n  initialPosts,\n  userId,\n}: {\n  initialPosts: Post[];\n  userId: string;\n}) {\n  const [posts, setPosts] = useState<Post[]>(initialPosts);\n  const [cursor, setCursor] = useState<string | null>(\n    initialPosts.length >= 20\n      ? initialPosts[initialPosts.length - 1].created_at\n      : null\n  );\n  const [loading, setLoading] = useState(false);\n  const sentinel = useRef<HTMLDivElement>(null);\n\n  const loadMore = useCallback(async () => {\n    if (!cursor || loading) return;\n    setLoading(true);\n\n    const res = await fetch(`/api/feed?cursor=${encodeURIComponent(cursor)}&limit=20`);\n    const data = await res.json();\n\n    if (data.posts?.length) {\n      setPosts((prev) => [...prev, ...data.posts]);\n      setCursor(data.next_cursor ?? null);\n    } else {\n      setCursor(null);\n    }\n    setLoading(false);\n  }, [cursor, loading]);\n\n  useEffect(() => {\n    if (!sentinel.current) return;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) loadMore();\n      },\n      { rootMargin: \"200px\" }\n    );\n    observer.observe(sentinel.current);\n    return () => observer.disconnect();\n  }, [loadMore]);\n\n  return (\n    <div>\n      {posts.map((post) => (\n        <ActivityCard key={post.id} post={post} />\n      ))}\n      {cursor && (\n        <div ref={sentinel} className=\"flex justify-center py-8\">\n          {loading && <span className=\"text-sm text-muted\">Loading...</span>}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAGO,SAAS,EAAS,cACvB,CAAY,QACZ,CAAM,CAIP,EACC,GAAM,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,GACrC,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAClC,EAAa,MAAM,EAAI,GACnB,CAAY,CAAC,EAAa,MAAM,CAAG,EAAE,CAAC,UAAU,CAChD,MAEA,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,EAAW,CAAA,EAAA,EAAA,MAAM,AAAN,EAAuB,MAElC,EAAW,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UAC3B,GAAI,CAAC,GAAU,EAAS,OACxB,GAAW,GAEX,IAAM,EAAM,MAAM,MAAM,CAAC,iBAAiB,EAAE,mBAAmB,GAAQ,SAAS,CAAC,EAC3E,EAAO,MAAM,EAAI,IAAI,GAEvB,EAAK,KAAK,EAAE,QAAQ,AACtB,EAAS,AAAC,GAAS,IAAI,KAAS,EAAK,KAAK,CAAC,EAC3C,EAAU,EAAK,WAAW,EAAI,OAE9B,EAAU,MAEZ,GAAW,EACb,EAAG,CAAC,EAAQ,EAAQ,EAcpB,MAZA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GAAI,CAAC,EAAS,OAAO,CAAE,OACvB,IAAM,EAAW,IAAI,qBACnB,AAAC,IACK,CAAO,CAAC,EAAE,CAAC,cAAc,EAAE,GACjC,EACA,CAAE,WAAY,OAAQ,GAGxB,OADA,EAAS,OAAO,CAAC,EAAS,OAAO,EAC1B,IAAM,EAAS,UAAU,EAClC,EAAG,CAAC,EAAS,EAGX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACE,EAAM,GAAG,CAAC,AAAC,GACV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,CAAe,KAAM,GAAf,EAAK,EAAE,GAE3B,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,IAAK,EAAU,UAAU,oCAC3B,GAAW,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8BAAqB,mBAK3D"}