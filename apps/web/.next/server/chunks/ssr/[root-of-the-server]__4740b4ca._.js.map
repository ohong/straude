{"version":3,"sources":["../../../../../../apps/web/components/app/feed/FeedList.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/app/%28app%29/feed/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const FeedList = registerClientReference(\n    function() { throw new Error(\"Attempted to call FeedList() from the server but FeedList is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/components/app/feed/FeedList.tsx\",\n    \"FeedList\",\n);\n","import { createClient } from \"@/lib/supabase/server\";\nimport { FeedList } from \"@/components/app/feed/FeedList\";\nimport type { Metadata } from \"next\";\n\nexport const metadata: Metadata = { title: \"Feed\" };\n\nexport default async function FeedPage() {\n  const supabase = await createClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  // Get first page of feed posts (from people user follows)\n  const { data: followRows } = await supabase\n    .from(\"follows\")\n    .select(\"following_id\")\n    .eq(\"follower_id\", user!.id);\n\n  const followingIds = followRows?.map((f) => f.following_id) ?? [];\n  // Include own posts in the feed\n  const feedUserIds = [user!.id, ...followingIds];\n\n  let posts: any[] = [];\n\n  if (feedUserIds.length > 0) {\n    const { data } = await supabase\n      .from(\"posts\")\n      .select(\n        `\n        *,\n        user:users!posts_user_id_fkey(*),\n        daily_usage:daily_usage!posts_daily_usage_id_fkey(*),\n        kudos_count:kudos(count),\n        comment_count:comments(count)\n      `\n      )\n      .in(\"user_id\", feedUserIds)\n      .order(\"created_at\", { ascending: false })\n      .limit(20);\n\n    if (data) {\n      // Check which posts current user has kudosed\n      const postIds = data.map((p: any) => p.id);\n      const { data: userKudos } = await supabase\n        .from(\"kudos\")\n        .select(\"post_id\")\n        .eq(\"user_id\", user!.id)\n        .in(\"post_id\", postIds);\n\n      const kudosedSet = new Set(userKudos?.map((k) => k.post_id));\n\n      posts = data.map((p: any) => ({\n        ...p,\n        kudos_count: p.kudos_count?.[0]?.count ?? 0,\n        comment_count: p.comment_count?.[0]?.count ?? 0,\n        has_kudosed: kudosedSet.has(p.id),\n      }));\n    }\n  }\n\n  return (\n    <>\n      <header className=\"sticky top-0 z-10 flex h-16 items-center border-b border-border bg-background px-6\">\n        <h3 className=\"text-lg font-medium\">Following</h3>\n      </header>\n\n      {posts.length > 0 ? (\n        <FeedList initialPosts={posts} userId={user!.id} />\n      ) : (\n        <div className=\"flex flex-col items-center justify-center px-6 py-20 text-center\">\n          <p className=\"text-lg font-medium\">Your feed is empty</p>\n          <p className=\"mt-2 text-sm text-muted\">\n            Follow some builders to see their posts here.\n          </p>\n          <a\n            href=\"/search\"\n            className=\"mt-4 inline-block bg-accent px-4 py-2 text-sm font-semibold text-white\"\n            style={{ borderRadius: 4 }}\n          >\n            Find users to follow\n          </a>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"uXAEO,IAAM,EAAW,CAAA,EAAA,AADxB,EAAA,CAAA,CAAA,OACwB,uBAAA,AAAuB,EAC3C,WAAa,MAAM,AAAI,MAAM,8NAAgO,EAC7P,0EACA,4DAHG,IAAM,EAAW,CAAA,EADxB,AACwB,EADxB,CAAA,CAAA,OACwB,uBAAA,AAAuB,EAC3C,WAAa,MAAM,AAAI,MAAM,8NAAgO,EAC7P,sDACA,gHCLJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAKe,eAAe,IAC5B,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAE7B,CACJ,KAAM,MAAE,CAAI,CAAE,CACf,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAGzB,CAAE,KAAM,CAAU,CAAE,CAAG,MAAM,EAChC,IAAI,CAAC,WACL,MAAM,CAAC,gBACP,EAAE,CAAC,cAAe,EAAM,EAAE,EAEvB,EAAe,GAAY,IAAI,AAAC,GAAM,EAAE,YAAY,GAAK,EAAE,CAE3D,EAAc,CAAC,EAAM,EAAE,IAAK,EAAa,CAE3C,EAAe,EAAE,CAErB,GAAI,EAAY,MAAM,CAAG,EAAG,CAC1B,GAAM,MAAE,CAAI,CAAE,CAAG,MAAM,EACpB,IAAI,CAAC,SACL,MAAM,CACL,CAAC;;;;;;MAMH,CAAC,EAEA,EAAE,CAAC,UAAW,GACd,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,IAET,GAAI,EAAM,CAER,IAAM,EAAU,EAAK,GAAG,CAAC,AAAC,GAAW,EAAE,EAAE,EACnC,CAAE,KAAM,CAAS,CAAE,CAAG,MAAM,EAC/B,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,UAAW,EAAM,EAAE,EACtB,EAAE,CAAC,UAAW,GAEX,EAAa,IAAI,IAAI,GAAW,IAAK,AAAD,GAAO,EAAE,OAAO,GAE1D,EAAQ,EAAK,GAAG,CAAC,AAAC,GAAY,CAAD,CAC3B,GAAG,CAAC,CACJ,YAAa,EAAE,WAAW,EAAE,CAAC,EAAE,EAAE,OAAS,EAC1C,cAAe,EAAE,aAAa,EAAE,CAAC,EAAE,EAAE,OAAS,EAC9C,YAAa,EAAW,GAAG,CAAC,EAAE,EAAE,CAClC,CAAC,EACH,CACF,CAEA,MACE,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACE,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,8FAChB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,+BAAsB,gBAGrC,EAAM,MAAM,CAAG,EACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,aAAc,EAAO,OAAQ,EAAM,EAAE,GAE/C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6EACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,+BAAsB,uBACnC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,mCAA0B,kDAGvC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CACC,KAAK,UACL,UAAU,yEACV,MAAO,CAAE,aAAc,CAAE,WAC1B,8BAOX,mCAlFkC,CAAE,MAAO,MAAO","ignoreList":[0]}