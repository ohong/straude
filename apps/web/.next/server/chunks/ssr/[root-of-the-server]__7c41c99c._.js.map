{"version":3,"sources":["../../../../../../apps/web/components/app/feed/ActivityCard.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/components/app/post/CommentThread.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/components/app/post/PostEditor.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/web/app/%28app%29/post/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ActivityCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call ActivityCard() from the server but ActivityCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/components/app/feed/ActivityCard.tsx\",\n    \"ActivityCard\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CommentThread = registerClientReference(\n    function() { throw new Error(\"Attempted to call CommentThread() from the server but CommentThread is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/components/app/post/CommentThread.tsx\",\n    \"CommentThread\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PostEditor = registerClientReference(\n    function() { throw new Error(\"Attempted to call PostEditor() from the server but PostEditor is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/web/components/app/post/PostEditor.tsx\",\n    \"PostEditor\",\n);\n","import { createClient } from \"@/lib/supabase/server\";\nimport { notFound } from \"next/navigation\";\nimport { ActivityCard } from \"@/components/app/feed/ActivityCard\";\nimport { CommentThread } from \"@/components/app/post/CommentThread\";\nimport { PostEditor } from \"@/components/app/post/PostEditor\";\nimport type { Metadata } from \"next\";\n\nexport async function generateMetadata({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}): Promise<Metadata> {\n  const { id } = await params;\n  const supabase = await createClient();\n  const { data: post } = await supabase\n    .from(\"posts\")\n    .select(\"title, user:users!posts_user_id_fkey(username)\")\n    .eq(\"id\", id)\n    .single();\n\n  return {\n    title: post?.title ?? `Post by ${(post?.user as any)?.username ?? \"user\"}`,\n  };\n}\n\nexport default async function PostDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}) {\n  const { id } = await params;\n  const supabase = await createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  const { data: post } = await supabase\n    .from(\"posts\")\n    .select(\n      `\n      *,\n      user:users!posts_user_id_fkey(*),\n      daily_usage:daily_usage!posts_daily_usage_id_fkey(*),\n      kudos_count:kudos(count),\n      comment_count:comments(count)\n    `\n    )\n    .eq(\"id\", id)\n    .single();\n\n  if (!post) notFound();\n\n  // Check if current user has kudosed\n  let hasKudosed = false;\n  if (user) {\n    const { data: k } = await supabase\n      .from(\"kudos\")\n      .select(\"id\")\n      .eq(\"user_id\", user.id)\n      .eq(\"post_id\", id)\n      .maybeSingle();\n    hasKudosed = !!k;\n  }\n\n  // Get first page of comments\n  const { data: comments } = await supabase\n    .from(\"comments\")\n    .select(\"*, user:users!comments_user_id_fkey(*)\")\n    .eq(\"post_id\", id)\n    .order(\"created_at\", { ascending: true })\n    .limit(20);\n\n  const normalizedPost = {\n    ...post,\n    kudos_count: (post.kudos_count as any)?.[0]?.count ?? 0,\n    comment_count: (post.comment_count as any)?.[0]?.count ?? 0,\n    has_kudosed: hasKudosed,\n  };\n\n  const isOwner = user?.id === post.user_id;\n\n  return (\n    <>\n      <header className=\"sticky top-0 z-10 flex h-16 items-center border-b border-border bg-background px-6\">\n        <h3 className=\"text-lg font-medium\">Post</h3>\n      </header>\n      <ActivityCard post={normalizedPost} />\n      {isOwner && <PostEditor post={normalizedPost} />}\n      <CommentThread\n        postId={id}\n        initialComments={comments ?? []}\n        userId={user?.id ?? null}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1,2]}