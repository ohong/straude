{"version":3,"sources":["../../../../../../apps/web/components/app/feed/FeedList.tsx","../../../../../../apps/web/components/app/profile/ContributionGraph.tsx","../../../../../../apps/web/components/app/profile/FollowButton.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState, useCallback } from \"react\";\nimport { ActivityCard } from \"./ActivityCard\";\nimport type { Post } from \"@/types\";\n\nexport function FeedList({\n  initialPosts,\n  userId,\n}: {\n  initialPosts: Post[];\n  userId: string;\n}) {\n  const [posts, setPosts] = useState<Post[]>(initialPosts);\n  const [cursor, setCursor] = useState<string | null>(\n    initialPosts.length >= 20\n      ? initialPosts[initialPosts.length - 1].created_at\n      : null\n  );\n  const [loading, setLoading] = useState(false);\n  const sentinel = useRef<HTMLDivElement>(null);\n\n  const loadMore = useCallback(async () => {\n    if (!cursor || loading) return;\n    setLoading(true);\n\n    const res = await fetch(`/api/feed?cursor=${encodeURIComponent(cursor)}&limit=20`);\n    const data = await res.json();\n\n    if (data.posts?.length) {\n      setPosts((prev) => [...prev, ...data.posts]);\n      setCursor(data.next_cursor ?? null);\n    } else {\n      setCursor(null);\n    }\n    setLoading(false);\n  }, [cursor, loading]);\n\n  useEffect(() => {\n    if (!sentinel.current) return;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) loadMore();\n      },\n      { rootMargin: \"200px\" }\n    );\n    observer.observe(sentinel.current);\n    return () => observer.disconnect();\n  }, [loadMore]);\n\n  return (\n    <div>\n      {posts.map((post) => (\n        <ActivityCard key={post.id} post={post} />\n      ))}\n      {cursor && (\n        <div ref={sentinel} className=\"flex justify-center py-8\">\n          {loading && <span className=\"text-sm text-muted\">Loading...</span>}\n        </div>\n      )}\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useState, useCallback } from \"react\";\nimport { cn } from \"@/lib/utils/cn\";\nimport type { ContributionDay } from \"@/types\";\n\nconst CELL_SIZE = 12;\nconst GAP = 3;\nconst STEP = CELL_SIZE + GAP;\nconst WEEKS = 52;\nconst DAYS = 7;\nconst MONTH_LABEL_HEIGHT = 16;\n\nfunction getCellColor(cost: number): string {\n  if (cost <= 0) return \"#E5E5E5\";\n  if (cost <= 10) return \"#FDD0B1\";\n  if (cost <= 50) return \"#F4945E\";\n  if (cost <= 100) return \"#DF561F\";\n  return \"#B8441A\";\n}\n\nfunction formatDateKey(d: Date): string {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\n  const day = String(d.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n}\n\nfunction formatDateLabel(d: Date): string {\n  return d.toLocaleDateString(\"en-US\", {\n    month: \"long\",\n    day: \"numeric\",\n    year: \"numeric\",\n  });\n}\n\nconst SHORT_MONTHS = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\ninterface ContributionGraphProps {\n  data: ContributionDay[];\n  onCellClick?: (date: string) => void;\n  className?: string;\n}\n\nexport function ContributionGraph({ data, onCellClick, className }: ContributionGraphProps) {\n  const [tooltip, setTooltip] = useState<{\n    x: number;\n    y: number;\n    date: string;\n    cost: number;\n  } | null>(null);\n\n  // Build lookup map from array\n  const lookup = new Map<string, ContributionDay>();\n  for (const entry of data) {\n    lookup.set(entry.date, entry);\n  }\n\n  // Build grid: 52 weeks x 7 days, most recent week on right, Sunday at top (day 0)\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  // Start from Sunday, 51 weeks ago\n  const startDate = new Date(today);\n  startDate.setDate(today.getDate() - today.getDay() - 51 * 7);\n\n  type CellData = { date: Date; key: string; weekIndex: number; dayIndex: number };\n  const cells: CellData[] = [];\n  const monthLabels: { label: string; x: number }[] = [];\n  let lastMonth = -1;\n\n  const cursor = new Date(startDate);\n  while (cursor <= today) {\n    const weekIndex = Math.floor(\n      (cursor.getTime() - startDate.getTime()) / (7 * 24 * 60 * 60 * 1000),\n    );\n    const dayIndex = cursor.getDay(); // 0=Sunday\n\n    cells.push({\n      date: new Date(cursor),\n      key: formatDateKey(cursor),\n      weekIndex,\n      dayIndex,\n    });\n\n    // Track month labels (first occurrence of a new month)\n    const month = cursor.getMonth();\n    if (month !== lastMonth) {\n      monthLabels.push({\n        label: SHORT_MONTHS[month]!,\n        x: weekIndex * STEP,\n      });\n      lastMonth = month;\n    }\n\n    cursor.setDate(cursor.getDate() + 1);\n  }\n\n  const svgWidth = (WEEKS + 1) * STEP;\n  const svgHeight = DAYS * STEP + MONTH_LABEL_HEIGHT;\n\n  const handleMouseEnter = useCallback(\n    (e: React.MouseEvent<SVGRectElement>, dateLabel: string, cost: number) => {\n      const rect = (e.target as SVGRectElement).getBoundingClientRect();\n      setTooltip({\n        x: rect.left + rect.width / 2,\n        y: rect.top,\n        date: dateLabel,\n        cost,\n      });\n    },\n    [],\n  );\n\n  const handleMouseLeave = useCallback(() => setTooltip(null), []);\n\n  return (\n    <div className={cn(\"relative overflow-x-auto\", className)} style={{ scrollbarWidth: \"none\" }}>\n      <svg width={svgWidth} height={svgHeight} className=\"block\">\n        {/* Month labels */}\n        {monthLabels.map((m, i) => (\n          <text\n            key={`${m.label}-${i}`}\n            x={m.x}\n            y={11}\n            className=\"fill-muted text-[10px]\"\n          >\n            {m.label}\n          </text>\n        ))}\n\n        {/* Cells */}\n        {cells.map((cell) => {\n          const entry = lookup.get(cell.key);\n          const cost = entry?.cost_usd ?? 0;\n          const hasPost = entry?.has_post ?? false;\n\n          return (\n            <rect\n              key={cell.key}\n              x={cell.weekIndex * STEP}\n              y={cell.dayIndex * STEP + MONTH_LABEL_HEIGHT}\n              width={CELL_SIZE}\n              height={CELL_SIZE}\n              rx={2}\n              fill={getCellColor(cost)}\n              stroke={hasPost ? \"#999\" : \"none\"}\n              strokeWidth={hasPost ? 1 : 0}\n              className={cn(onCellClick && hasPost && \"cursor-pointer\")}\n              onMouseEnter={(e) => handleMouseEnter(e, formatDateLabel(cell.date), cost)}\n              onMouseLeave={handleMouseLeave}\n              onClick={() => {\n                if (onCellClick && hasPost) onCellClick(cell.key);\n              }}\n            />\n          );\n        })}\n      </svg>\n\n      {tooltip && (\n        <div\n          className=\"pointer-events-none fixed z-50 -translate-x-1/2 -translate-y-full rounded-[4px] px-3 py-2 text-sm text-white shadow-lg\"\n          style={{\n            left: tooltip.x,\n            top: tooltip.y - 8,\n            background: \"#000\",\n          }}\n        >\n          <p className=\"font-normal leading-snug\">{tooltip.date}</p>\n          <p className=\"font-mono tabular-nums\">\n            ${tooltip.cost.toFixed(2)}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useState } from \"react\";\n\nexport function FollowButton({\n  username,\n  initialFollowing,\n}: {\n  username: string;\n  initialFollowing: boolean;\n}) {\n  const [following, setFollowing] = useState(initialFollowing);\n  const [loading, setLoading] = useState(false);\n\n  async function toggle() {\n    setLoading(true);\n    const method = following ? \"DELETE\" : \"POST\";\n    const res = await fetch(`/api/follow/${username}`, { method });\n    if (res.ok) {\n      setFollowing(!following);\n    }\n    setLoading(false);\n  }\n\n  return (\n    <button\n      onClick={toggle}\n      disabled={loading}\n      className={\n        following\n          ? \"border border-border px-3 py-1 text-sm font-semibold hover:bg-subtle disabled:opacity-50\"\n          : \"bg-accent px-3 py-1 text-sm font-semibold text-white disabled:opacity-50\"\n      }\n      style={{ borderRadius: 4 }}\n    >\n      {following ? \"Following\" : \"Follow\"}\n    </button>\n  );\n}\n"],"names":[],"mappings":"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"}